{% extends "base.html" %}

{% block title %}AI Trading Analysis - Sofia V2{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900/20 to-slate-900">
    <!-- Header -->
    <div class="border-b border-purple-500/20 backdrop-blur-xl bg-slate-900/50">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
                        AI Trading Analysis
                    </h1>
                    <p class="text-gray-400 mt-1">Yapay Zeka Destekli Alım-Satım Önerileri</p>
                </div>
                <div class="flex items-center gap-4">
                    <button onclick="refreshAnalysis()" class="px-4 py-2 bg-purple-600/20 hover:bg-purple-600/30 border border-purple-500/30 rounded-lg text-purple-300 transition-all">
                        <i class="fas fa-sync-alt mr-2"></i>Yenile
                    </button>
                    <div class="text-sm text-gray-400">
                        Son Güncelleme: <span id="lastUpdate" class="text-purple-400">{{ last_update }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Score Legend -->
    <div class="container mx-auto px-6 py-6">
        <div class="glass-ultra rounded-xl p-4 mb-6">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div class="flex items-center gap-6">
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                        <span class="text-sm text-gray-400">Güçlü Al (85-100)</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 bg-lime-500 rounded-full"></div>
                        <span class="text-sm text-gray-400">Al (70-84)</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                        <span class="text-sm text-gray-400">Nötr (50-69)</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 bg-orange-500 rounded-full"></div>
                        <span class="text-sm text-gray-400">Sat (30-49)</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>
                        <span class="text-sm text-gray-400">Güçlü Sat (0-29)</span>
                    </div>
                </div>
                <div class="text-sm text-gray-500">
                    <i class="fas fa-robot text-purple-400 mr-2"></i>
                    AI Model: GPT-4 + Technical Analysis
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="container mx-auto px-6">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            
            <!-- Crypto Analysis -->
            <div class="glass-ultra rounded-xl p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-bold text-white flex items-center gap-2">
                        <i class="fab fa-bitcoin text-yellow-500"></i>
                        Kripto Analizi
                    </h2>
                    <span class="text-xs text-gray-500">24h Volume: ${{ crypto_volume }}</span>
                </div>

                <div class="space-y-4">
                    {% for crypto in crypto_analysis %}
                    <div class="bg-slate-800/50 rounded-lg p-4 hover:bg-slate-800/70 transition-all border border-slate-700/50">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-gradient-to-br from-purple-500/20 to-pink-500/20 rounded-full flex items-center justify-center">
                                    <i class="fab fa-{{ crypto.icon }} text-{{ crypto.color }}"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-white">{{ crypto.symbol }}</h3>
                                    <p class="text-xs text-gray-400">{{ crypto.name }}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-lg font-bold text-white">${{ "{:,.2f}".format(crypto.price) }}</div>
                                <div class="text-sm {% if crypto.change > 0 %}text-green-400{% else %}text-red-400{% endif %}">
                                    {% if crypto.change > 0 %}+{% endif %}{{ crypto.change }}%
                                </div>
                            </div>
                        </div>

                        <!-- AI Score Bar -->
                        <div class="mb-3">
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-xs text-gray-400">AI Score</span>
                                <span class="text-sm font-bold {% if crypto.ai_score >= 85 %}text-green-400{% elif crypto.ai_score >= 70 %}text-lime-400{% elif crypto.ai_score >= 50 %}text-yellow-400{% elif crypto.ai_score >= 30 %}text-orange-400{% else %}text-red-400{% endif %}">
                                    {{ crypto.ai_score }}/100
                                </span>
                            </div>
                            <div class="w-full bg-slate-700 rounded-full h-2">
                                <div class="h-2 rounded-full transition-all duration-500 
                                    {% if crypto.ai_score >= 85 %}bg-gradient-to-r from-green-500 to-emerald-400{% elif crypto.ai_score >= 70 %}bg-gradient-to-r from-lime-500 to-green-400{% elif crypto.ai_score >= 50 %}bg-gradient-to-r from-yellow-500 to-lime-400{% elif crypto.ai_score >= 30 %}bg-gradient-to-r from-orange-500 to-yellow-400{% else %}bg-gradient-to-r from-red-500 to-orange-400{% endif %}"
                                    style="width: {{ crypto.ai_score }}%">
                                </div>
                            </div>
                        </div>

                        <!-- Analysis Details -->
                        <div class="grid grid-cols-3 gap-2 mb-3">
                            <div class="text-center">
                                <div class="text-xs text-gray-500">Teknik</div>
                                <div class="text-sm font-semibold {% if crypto.technical_score >= 70 %}text-green-400{% elif crypto.technical_score >= 40 %}text-yellow-400{% else %}text-red-400{% endif %}">
                                    {{ crypto.technical_score }}%
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="text-xs text-gray-500">Momentum</div>
                                <div class="text-sm font-semibold {% if crypto.momentum_score >= 70 %}text-green-400{% elif crypto.momentum_score >= 40 %}text-yellow-400{% else %}text-red-400{% endif %}">
                                    {{ crypto.momentum_score }}%
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="text-xs text-gray-500">Volume</div>
                                <div class="text-sm font-semibold {% if crypto.volume_score >= 70 %}text-green-400{% elif crypto.volume_score >= 40 %}text-yellow-400{% else %}text-red-400{% endif %}">
                                    {{ crypto.volume_score }}%
                                </div>
                            </div>
                        </div>

                        <!-- AI Recommendation -->
                        <div class="bg-slate-900/50 rounded p-2">
                            <p class="text-xs text-gray-400 mb-1">AI Önerisi:</p>
                            <p class="text-sm text-purple-300">{{ crypto.ai_recommendation }}</p>
                        </div>

                        <!-- Action Button -->
                        <button class="mt-3 w-full py-2 rounded-lg font-semibold text-sm transition-all
                            {% if crypto.ai_score >= 70 %}
                                bg-gradient-to-r from-green-600/20 to-emerald-600/20 hover:from-green-600/30 hover:to-emerald-600/30 border border-green-500/30 text-green-400
                            {% elif crypto.ai_score >= 50 %}
                                bg-gradient-to-r from-yellow-600/20 to-orange-600/20 hover:from-yellow-600/30 hover:to-orange-600/30 border border-yellow-500/30 text-yellow-400
                            {% else %}
                                bg-gradient-to-r from-red-600/20 to-orange-600/20 hover:from-red-600/30 hover:to-orange-600/30 border border-red-500/30 text-red-400
                            {% endif %}">
                            {% if crypto.ai_score >= 70 %}
                                <i class="fas fa-shopping-cart mr-2"></i>Al
                            {% elif crypto.ai_score >= 50 %}
                                <i class="fas fa-pause mr-2"></i>Bekle
                            {% else %}
                                <i class="fas fa-hand-paper mr-2"></i>Sat
                            {% endif %}
                        </button>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Stock Analysis -->
            <div class="glass-ultra rounded-xl p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-bold text-white flex items-center gap-2">
                        <i class="fas fa-chart-line text-blue-500"></i>
                        Hisse Analizi
                    </h2>
                    <span class="text-xs text-gray-500">BIST-100</span>
                </div>

                <div class="space-y-4">
                    {% for stock in stock_analysis %}
                    <div class="bg-slate-800/50 rounded-lg p-4 hover:bg-slate-800/70 transition-all border border-slate-700/50">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-gradient-to-br from-blue-500/20 to-cyan-500/20 rounded-full flex items-center justify-center">
                                    <span class="text-xs font-bold text-blue-400">{{ stock.symbol[:2] }}</span>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-white">{{ stock.symbol }}</h3>
                                    <p class="text-xs text-gray-400">{{ stock.name }}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-lg font-bold text-white">₺{{ "{:,.2f}".format(stock.price) }}</div>
                                <div class="text-sm {% if stock.change > 0 %}text-green-400{% else %}text-red-400{% endif %}">
                                    {% if stock.change > 0 %}+{% endif %}{{ stock.change }}%
                                </div>
                            </div>
                        </div>

                        <!-- AI Score Bar -->
                        <div class="mb-3">
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-xs text-gray-400">AI Score</span>
                                <span class="text-sm font-bold {% if stock.ai_score >= 85 %}text-green-400{% elif stock.ai_score >= 70 %}text-lime-400{% elif stock.ai_score >= 50 %}text-yellow-400{% elif stock.ai_score >= 30 %}text-orange-400{% else %}text-red-400{% endif %}">
                                    {{ stock.ai_score }}/100
                                </span>
                            </div>
                            <div class="w-full bg-slate-700 rounded-full h-2">
                                <div class="h-2 rounded-full transition-all duration-500 
                                    {% if stock.ai_score >= 85 %}bg-gradient-to-r from-green-500 to-emerald-400{% elif stock.ai_score >= 70 %}bg-gradient-to-r from-lime-500 to-green-400{% elif stock.ai_score >= 50 %}bg-gradient-to-r from-yellow-500 to-lime-400{% elif stock.ai_score >= 30 %}bg-gradient-to-r from-orange-500 to-yellow-400{% else %}bg-gradient-to-r from-red-500 to-orange-400{% endif %}"
                                    style="width: {{ stock.ai_score }}%">
                                </div>
                            </div>
                        </div>

                        <!-- Analysis Details -->
                        <div class="grid grid-cols-3 gap-2 mb-3">
                            <div class="text-center">
                                <div class="text-xs text-gray-500">F/K</div>
                                <div class="text-sm font-semibold text-purple-400">{{ stock.pe_ratio }}</div>
                            </div>
                            <div class="text-center">
                                <div class="text-xs text-gray-500">PD/DD</div>
                                <div class="text-sm font-semibold text-purple-400">{{ stock.pb_ratio }}</div>
                            </div>
                            <div class="text-center">
                                <div class="text-xs text-gray-500">Hedef</div>
                                <div class="text-sm font-semibold text-green-400">₺{{ stock.target_price }}</div>
                            </div>
                        </div>

                        <!-- AI Recommendation -->
                        <div class="bg-slate-900/50 rounded p-2">
                            <p class="text-xs text-gray-400 mb-1">AI Önerisi:</p>
                            <p class="text-sm text-purple-300">{{ stock.ai_recommendation }}</p>
                        </div>

                        <!-- Action Button -->
                        <button class="mt-3 w-full py-2 rounded-lg font-semibold text-sm transition-all
                            {% if stock.ai_score >= 70 %}
                                bg-gradient-to-r from-green-600/20 to-emerald-600/20 hover:from-green-600/30 hover:to-emerald-600/30 border border-green-500/30 text-green-400
                            {% elif stock.ai_score >= 50 %}
                                bg-gradient-to-r from-yellow-600/20 to-orange-600/20 hover:from-yellow-600/30 hover:to-orange-600/30 border border-yellow-500/30 text-yellow-400
                            {% else %}
                                bg-gradient-to-r from-red-600/20 to-orange-600/20 hover:from-red-600/30 hover:to-orange-600/30 border border-red-500/30 text-red-400
                            {% endif %}">
                            {% if stock.ai_score >= 70 %}
                                <i class="fas fa-shopping-cart mr-2"></i>Al
                            {% elif stock.ai_score >= 50 %}
                                <i class="fas fa-pause mr-2"></i>Bekle
                            {% else %}
                                <i class="fas fa-hand-paper mr-2"></i>Sat
                            {% endif %}
                        </button>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Top Recommendations -->
        <div class="mt-6 glass-ultra rounded-xl p-6">
            <h2 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                <i class="fas fa-trophy text-yellow-500"></i>
                Günün En İyi Fırsatları
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                {% for opp in top_opportunities %}
                <div class="bg-gradient-to-br from-{{ opp.color }}-600/10 to-{{ opp.color }}-700/10 rounded-lg p-4 border border-{{ opp.color }}-500/30">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-bold text-{{ opp.color }}-400">{{ opp.rank }}. {{ opp.symbol }}</span>
                        <span class="px-2 py-1 bg-{{ opp.color }}-500/20 rounded text-xs text-{{ opp.color }}-300">{{ opp.type }}</span>
                    </div>
                    <div class="text-2xl font-bold text-white mb-1">{{ opp.potential }}%</div>
                    <div class="text-xs text-gray-400 mb-2">Potansiyel Getiri</div>
                    <div class="text-sm text-gray-300">{{ opp.reason }}</div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<script>
function refreshAnalysis() {
    // Show loading state
    const btn = event.target;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Yükleniyor...';
    btn.disabled = true;
    
    // Reload page after delay
    setTimeout(() => {
        window.location.reload();
    }, 1000);
}

// Auto refresh every 30 seconds
setInterval(() => {
    document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('tr-TR');
}, 30000);
</script>
{% endblock %}