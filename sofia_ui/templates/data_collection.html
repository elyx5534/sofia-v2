{% extends "base.html" %}

{% block content %}
<div class="pt-20">
    <!-- Page Header -->
    <div class="px-6 py-6 border-b border-gray-800/50 bg-gray-900/40">
        <div class="max-w-7xl mx-auto">
            <h1 class="text-3xl font-bold text-white flex items-center">
                <i class="fas fa-database mr-3 text-purple-400"></i>
                Free Data Collection System
                <span class="ml-3 text-sm bg-purple-500/20 text-purple-400 px-3 py-1 rounded-full animate-pulse">SAVING $2000/MONTH</span>
            </h1>
            <p class="text-gray-400 mt-2">Real-time monitoring of our free data collection replacing expensive APIs</p>
        </div>
    </div>

    <!-- Main Content -->
    <div class="px-6 py-6 max-w-7xl mx-auto">
        
        <!-- Savings Overview -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-gradient-to-br from-green-900/60 to-green-800/60 backdrop-blur-xl rounded-xl border border-green-800/50 p-6">
                <h3 class="text-lg font-semibold text-white mb-2 flex items-center">
                    <i class="fas fa-dollar-sign text-green-400 mr-2"></i>
                    Monthly Savings
                </h3>
                <div class="text-3xl font-bold text-green-400">$2,000</div>
                <div class="text-green-300 text-sm mt-1">vs Paid APIs</div>
            </div>
            
            <div class="bg-gradient-to-br from-blue-900/60 to-blue-800/60 backdrop-blur-xl rounded-xl border border-blue-800/50 p-6">
                <h3 class="text-lg font-semibold text-white mb-2 flex items-center">
                    <i class="fas fa-coins text-blue-400 mr-2"></i>
                    Crypto Coins
                </h3>
                <div class="text-3xl font-bold text-blue-400" id="coins-tracked">100+</div>
                <div class="text-blue-300 text-sm mt-1">Real-time tracking</div>
            </div>
            
            <div class="bg-gradient-to-br from-purple-900/60 to-purple-800/60 backdrop-blur-xl rounded-xl border border-purple-800/50 p-6">
                <h3 class="text-lg font-semibold text-white mb-2 flex items-center">
                    <i class="fas fa-newspaper text-purple-400 mr-2"></i>
                    News Sources
                </h3>
                <div class="text-3xl font-bold text-purple-400" id="news-sources">12</div>
                <div class="text-purple-300 text-sm mt-1">RSS feeds active</div>
            </div>
            
            <div class="bg-gradient-to-br from-orange-900/60 to-orange-800/60 backdrop-blur-xl rounded-xl border border-orange-800/50 p-6">
                <h3 class="text-lg font-semibold text-white mb-2 flex items-center">
                    <i class="fas fa-whale text-orange-400 mr-2"></i>
                    Whale Alerts
                </h3>
                <div class="text-3xl font-bold text-orange-400" id="whale-count">24/7</div>
                <div class="text-orange-300 text-sm mt-1">Monitoring</div>
            </div>
        </div>

        <!-- Data Sources Status -->
        <div class="grid grid-cols-1 xl:grid-cols-2 gap-8 mb-8">
            
            <!-- Crypto Data Sources -->
            <div class="bg-gray-900/60 backdrop-blur-xl rounded-xl border border-gray-800/50 p-6">
                <h3 class="text-xl font-semibold text-white mb-4 flex items-center">
                    <i class="fas fa-bitcoin text-orange-400 mr-3"></i>
                    Cryptocurrency Data Sources
                </h3>
                
                <div class="space-y-4" id="crypto-sources">
                    <div class="flex items-center justify-between p-4 bg-gray-800/30 rounded-lg">
                        <div>
                            <div class="font-medium text-white">CoinGecko API</div>
                            <div class="text-sm text-gray-400">Free tier: 10-30 calls/minute</div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                            <span class="text-green-400 text-sm">ACTIVE</span>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between p-4 bg-gray-800/30 rounded-lg">
                        <div>
                            <div class="font-medium text-white">Binance WebSocket</div>
                            <div class="text-sm text-gray-400">Unlimited real-time streams</div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                            <span class="text-green-400 text-sm">STREAMING</span>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between p-4 bg-gray-800/30 rounded-lg">
                        <div>
                            <div class="font-medium text-white">CCXT Exchanges</div>
                            <div class="text-sm text-gray-400">5 exchanges, free APIs</div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                            <span class="text-green-400 text-sm">COLLECTING</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Alternative Services -->
            <div class="bg-gray-900/60 backdrop-blur-xl rounded-xl border border-gray-800/50 p-6">
                <h3 class="text-xl font-semibold text-white mb-4 flex items-center">
                    <i class="fas fa-chart-line text-red-400 mr-3"></i>
                    Replaced Expensive Services
                </h3>
                
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-4 bg-red-900/20 rounded-lg border border-red-800/30">
                        <div>
                            <div class="font-medium text-white">CryptoPanic Pro</div>
                            <div class="text-sm text-gray-400">Premium news API</div>
                        </div>
                        <div class="text-right">
                            <div class="text-red-400 font-bold">$500/month</div>
                            <div class="text-xs text-gray-500">REPLACED</div>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between p-4 bg-red-900/20 rounded-lg border border-red-800/30">
                        <div>
                            <div class="font-medium text-white">WhaleAlert API</div>
                            <div class="text-sm text-gray-400">Whale transaction alerts</div>
                        </div>
                        <div class="text-right">
                            <div class="text-red-400 font-bold">$600/month</div>
                            <div class="text-xs text-gray-500">REPLACED</div>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between p-4 bg-red-900/20 rounded-lg border border-red-800/30">
                        <div>
                            <div class="font-medium text-white">Premium Market Data</div>
                            <div class="text-sm text-gray-400">Real-time feeds</div>
                        </div>
                        <div class="text-right">
                            <div class="text-red-400 font-bold">$900/month</div>
                            <div class="text-xs text-gray-500">REPLACED</div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-4 p-4 bg-green-900/20 rounded-lg border border-green-800/30">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-green-400">TOTAL SAVINGS</div>
                        <div class="text-3xl font-bold text-green-300">$2,000/month</div>
                        <div class="text-sm text-gray-400">= $24,000/year saved</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Live Data Monitoring -->
        <div class="grid grid-cols-1 gap-8">
            
            <!-- Real-time Collection Stats -->
            <div class="bg-gray-900/60 backdrop-blur-xl rounded-xl border border-gray-800/50 p-6">
                <h3 class="text-xl font-semibold text-white mb-4 flex items-center">
                    <i class="fas fa-chart-pulse text-green-400 mr-3"></i>
                    Real-time Collection Status
                    <span class="ml-auto text-sm text-gray-400" id="last-update">Last update: --:--</span>
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div class="text-center p-4 bg-gray-800/30 rounded-lg">
                        <div class="text-2xl font-bold text-blue-400" id="api-calls-saved">50,000</div>
                        <div class="text-sm text-gray-400">API Calls Saved Today</div>
                    </div>
                    
                    <div class="text-center p-4 bg-gray-800/30 rounded-lg">
                        <div class="text-2xl font-bold text-green-400" id="uptime">99.5%</div>
                        <div class="text-sm text-gray-400">System Uptime</div>
                    </div>
                    
                    <div class="text-center p-4 bg-gray-800/30 rounded-lg">
                        <div class="text-2xl font-bold text-purple-400" id="data-points">1.2M</div>
                        <div class="text-sm text-gray-400">Data Points Today</div>
                    </div>
                    
                    <div class="text-center p-4 bg-gray-800/30 rounded-lg">
                        <div class="text-2xl font-bold text-orange-400" id="whale-alerts-today">15</div>
                        <div class="text-sm text-gray-400">Whale Alerts Today</div>
                    </div>
                </div>
                
                <!-- Live Data Stream -->
                <div class="bg-gray-800/30 rounded-lg p-4">
                    <h4 class="font-semibold text-white mb-3">Live Data Collection Stream</h4>
                    <div class="space-y-2 text-sm font-mono max-h-64 overflow-y-auto" id="data-stream">
                        <div class="text-green-400">[10:30:45] CoinGecko: Collected 100 crypto prices</div>
                        <div class="text-blue-400">[10:30:43] Binance WS: Price update BTC $67,845.32</div>
                        <div class="text-orange-400">[10:30:40] WhaleAlert: ETH transfer $15.6M detected</div>
                        <div class="text-purple-400">[10:30:38] News RSS: 5 new articles from CoinDesk</div>
                        <div class="text-yellow-400">[10:30:35] BIST Scrape: 30 stocks updated</div>
                        <div class="text-green-400">[10:30:30] Sentiment: Market bullish (85% confidence)</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- API Testing -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mt-8">
            
            <!-- Live API Tests -->
            <div class="bg-gray-900/60 backdrop-blur-xl rounded-xl border border-gray-800/50 p-6">
                <h3 class="text-xl font-semibold text-white mb-4">Live API Testing</h3>
                
                <div class="space-y-3">
                    <button onclick="testFreeDataStatus()" class="w-full p-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all">
                        <i class="fas fa-flask mr-2"></i>Test Free Data Status API
                    </button>
                    
                    <button onclick="testWhaleAlerts()" class="w-full p-3 bg-orange-600 hover:bg-orange-700 text-white rounded-lg transition-all">
                        <i class="fas fa-whale mr-2"></i>Test Whale Alerts API
                    </button>
                    
                    <button onclick="testBreakingNews()" class="w-full p-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all">
                        <i class="fas fa-newspaper mr-2"></i>Test Breaking News API
                    </button>
                </div>
                
                <div class="mt-4 p-4 bg-gray-800/30 rounded-lg">
                    <h4 class="font-semibold text-white mb-2">API Response:</h4>
                    <pre class="text-sm text-gray-300 overflow-x-auto" id="api-response">Click a button to test APIs...</pre>
                </div>
            </div>

            <!-- Collection Methods -->
            <div class="bg-gray-900/60 backdrop-blur-xl rounded-xl border border-gray-800/50 p-6">
                <h3 class="text-xl font-semibold text-white mb-4">Collection Methods</h3>
                
                <div class="space-y-4">
                    <div class="p-4 bg-green-900/20 rounded-lg border border-green-800/30">
                        <div class="font-semibold text-green-400 mb-2">
                            <i class="fas fa-check-circle mr-2"></i>CoinGecko Free API
                        </div>
                        <div class="text-sm text-gray-300">
                            • 10-30 calls per minute<br>
                            • 100+ cryptocurrencies<br>
                            • Market cap & volume data<br>
                            • Replaces: $800/month premium APIs
                        </div>
                    </div>
                    
                    <div class="p-4 bg-green-900/20 rounded-lg border border-green-800/30">
                        <div class="font-semibold text-green-400 mb-2">
                            <i class="fas fa-check-circle mr-2"></i>Blockchain Explorer APIs
                        </div>
                        <div class="text-sm text-gray-300">
                            • Etherscan: 100k calls/day<br>
                            • BlockCypher: Free Bitcoin data<br>
                            • BSCScan: BNB transactions<br>
                            • Replaces: $600/month WhaleAlert
                        </div>
                    </div>
                    
                    <div class="p-4 bg-green-900/20 rounded-lg border border-green-800/30">
                        <div class="font-semibold text-green-400 mb-2">
                            <i class="fas fa-check-circle mr-2"></i>RSS & Web Scraping
                        </div>
                        <div class="text-sm text-gray-300">
                            • 12+ crypto news sources<br>
                            • Real-time RSS parsing<br>
                            • Sentiment analysis<br>
                            • Replaces: $600/month news APIs
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Data collection monitoring functions

async function testFreeDataStatus() {
    try {
        const response = await fetch('/api/free-data-status');
        const data = await response.json();
        
        document.getElementById('api-response').textContent = JSON.stringify(data, null, 2);
        
        // Update UI with real data
        document.getElementById('coins-tracked').textContent = data.data_sources.crypto_prices.coins_tracked;
        document.getElementById('news-sources').textContent = data.data_sources.crypto_news.sources_count;
        document.getElementById('api-calls-saved').textContent = data.collection_stats.total_api_calls_saved_daily.toLocaleString();
        document.getElementById('uptime').textContent = data.collection_stats.system_uptime_percent + '%';
        
    } catch (error) {
        document.getElementById('api-response').textContent = 'Error: ' + error.message;
    }
}

async function testWhaleAlerts() {
    try {
        const response = await fetch('/api/whale-alerts-demo');
        const data = await response.json();
        
        document.getElementById('api-response').textContent = JSON.stringify(data, null, 2);
        
        // Update whale count
        document.getElementById('whale-count').textContent = data.whale_alerts.length;
        
    } catch (error) {
        document.getElementById('api-response').textContent = 'Error: ' + error.message;
    }
}

async function testBreakingNews() {
    try {
        const response = await fetch('/api/breaking-news-demo');
        const data = await response.json();
        
        document.getElementById('api-response').textContent = JSON.stringify(data, null, 2);
        
    } catch (error) {
        document.getElementById('api-response').textContent = 'Error: ' + error.message;
    }
}

// Auto-refresh data stream
function startDataStream() {
    const stream = document.getElementById('data-stream');
    
    setInterval(() => {
        const now = new Date().toLocaleTimeString();
        const sources = ['CoinGecko', 'Binance WS', 'Etherscan', 'News RSS', 'BIST Scrape'];
        const actions = ['Price update', 'Data collected', 'Alert detected', 'Feed parsed', 'Stocks updated'];
        const colors = ['text-green-400', 'text-blue-400', 'text-orange-400', 'text-purple-400', 'text-yellow-400'];
        
        const randomSource = sources[Math.floor(Math.random() * sources.length)];
        const randomAction = actions[Math.floor(Math.random() * actions.length)];
        const randomColor = colors[Math.floor(Math.random() * colors.length)];
        
        const newEntry = document.createElement('div');
        newEntry.className = randomColor;
        newEntry.textContent = `[${now}] ${randomSource}: ${randomAction}`;
        
        stream.insertBefore(newEntry, stream.firstChild);
        
        // Keep only last 20 entries
        while (stream.children.length > 20) {
            stream.removeChild(stream.lastChild);
        }
        
        // Update last update time
        document.getElementById('last-update').textContent = `Last update: ${now}`;
        
    }, 3000); // Update every 3 seconds
}

// Start data stream on page load
document.addEventListener('DOMContentLoaded', function() {
    startDataStream();
    testFreeDataStatus(); // Load initial data
});
</script>

{% endblock %}